pipeline{
    agent any
    parameters {
                string(name: 'Branch_Name', defaultValue: 'main', description: 'Input the Branch name to Build')
                choice(name: 'Choice', choices: ['One', 'Two', 'Three'], description: 'Make a selection')
    }
    stages{

    stage('Git checkout'){
        steps{
            echo "git checkout"
            git branch: '$Branch_Name', changelog: false, credentialsId: 'pumejgitpsswd', poll: false, url: 'https://github.com/IBT-learning/ibt-maven.git'
        }
    }
    stage('Test'){
        steps{
            withMaven(maven: 'maven_3.8') {
                bat 'mvn test'
            }
        }
    }
    stage('Validate'){
        steps{
            withMaven(maven: 'maven_3.8') {
                bat 'mvn validate'
                }
           }
        }
    stage('Compile'){
         steps{
             withMaven(maven: 'maven_3.8') {
                 bat 'mvn compile'
                 }
             }
         }
    stage('Package'){
          steps{
              withMaven(maven: 'maven_3.8') {
                    bat 'mvn package'
                   }
              }
          }
    stage('Deploy'){
           steps{
                withMaven(maven: 'maven_3.8') {
                    withCredentials([file(credentialsId: 'settingsxml_pumej', variable: 'settingsxml_pumej')]) {
                        bat 'mvn deploy -s $settingsxml_pumej'
                        }
                    }
                }
           }
    stage('Deploy with Config file'){
           steps{
                withMaven(maven: 'maven_3.8') {
                    configFileProvider([configFile(fileId: 'artifactory-settings', variable: 'settingsxml_managed')]) {
                        bat 'mvn deploy -s $settingsxml_managed'
                        }
                    }
                }
           }
    }
     post {
          always {
                   echo 'This is the end of the PIPELINE!!! PROJECT WAS SUCCESSFUL'
          }
    }
}