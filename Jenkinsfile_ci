pipeline{
    agent any

    stages{
    stage('Git checkout'){
        steps{
            git branch: 'feature_abreham', credentialsId: 'mvn_user_credential_github', url: 'https://github.com/IBT-learning/ibt-maven.git'
          }
        }
        stage('validate'){
            steps{
            withMaven(maven: 'maven_3.9.3') {
                sh 'mvn validate'
                }
            }
        }
        stage('compile'){
                    steps{
                    withMaven(maven: 'maven_3.9.3') {
                        sh 'mvn compile'
                        }
                    }
                }
                stage('test'){
                       steps{
                            withMaven(maven: 'maven_3.9.3') {
                                  sh 'mvn test'
                                  }
                           }
                      }

                      stage('SonarQube Analysis'){
                            steps{
                                IBT_sonarQube
                                withSonarQubeEnv(credentialsId: 'SQ-student', installationName: ' IBT_sonarQube') {
                                    sh '${env.sonarScan}/bin/sonar-scanner'
                                }
                            }
                      }
                      stage('package'){
                            steps{
                                 withMaven(maven: 'maven_3.9.3') {
                                         sh 'mvn package'
                                         }
                                 }
                           }
                      stage('Upload to Artifactory'){
                           steps{
                              withMaven(maven: 'maven_3.8'){
                                    withCredentials([file(credentialsId: 'mvn_settings_abreham', variable: 'mvn_settings')]) {
                                       sh 'mvn deploy -s $mvn_settings_abreham'
                                        }
                                    }
                                }
                           }
                }
}